<html lang="en">
<head>
<META content="text/html; charset=utf-8" http-equiv=Content-Type>
<META name="Generator" content="Visustin">
<META name="description" content="T-SQL flow chart saved by Aivosto Visustin (www.aivosto.com).">
<META name="keywords" content="T-SQL, flow graph, diagram">

<title>T-SQL flow chart: proc_GenTrackerCTProcMASTER.sql</title>

<style type="text/css">
<!--
BODY      { margin: 0; }
TEXTAREA  { background: #ffffcc; font-size: 8pt; }
A:link, A:visited { color: blue; }
TR.bar    { background: white; font-family: Verdana, Arial, Sans-Serif; font-size: 70%; }
TR TD     { padding: 0; background: white; }
TR.bar TD { padding: 2px 5px 2px 5px; background: #ccccff; }
-->
</style>

<script type="text/javascript">
<!--
function hidecode(id) { 
  if (id.style.display=="none") {
    id.style.display="";
    hidelink.innerHTML="Hide code";
  } else {
    id.style.display="none";
    hidelink.innerHTML="Show code";
  }
}
-->
</script>
</head>


<body scroll=no>

<table width="100%" height="100%" cellspacing="0" cellpadding="0" border="0">

<tr height="100%"><td id="#upper" colspan="2">
 <iframe name="pic" width="100%" height="100%" src="proc_GenTrackerCTProcMASTER.png" frameborder="0" title="T-SQL flow chart: proc_GenTrackerCTProcMASTER.sql">
  <a href="proc_GenTrackerCTProcMASTER.png"><img src="proc_GenTrackerCTProcMASTER.png" height="100%" title="T-SQL flow chart: proc_GenTrackerCTProcMASTER.sql"></a>
 </iframe>
</td></tr>

<tr id="sourcecode"><td colspan="2">
<textarea rows=15 readonly=yes style="width:100%; border-width:0;">


GO
PRINT 'EXECUTING proc_GenTrackerCTProcMASTER.sql';
GO
IF EXISTS (SELECT
       name
   FROM sys.procedures
   WHERE
       name = 'proc_GenTrackerCTProcMASTER')
 BEGIN
  DROP PROCEDURE
     proc_GenTrackerCTProcMASTER;
 END;
GO
-- EXEC proc_GenTrackerCTProcMASTER 'YES'
CREATE PROCEDURE proc_GenTrackerCTProcMASTER (@PreviewOnly as nvarchar(50) = 'NO')
AS
BEGIN

 DECLARE
   @cmd AS NVARCHAR (MAX) = '';

 IF OBJECT_ID ( 'usp_GetErrorInfo' , 'P') IS NULL
  BEGIN
    SET @cmd = 'CREATE PROCEDURE usp_GetErrorInfo ' + CHAR (10) ;
    SET @cmd = @cmd + 'AS ' + CHAR (10) ;
    SET @cmd = @cmd + ' SELECT ERROR_NUMBER() AS ErrorNumber ' + CHAR (10) ;
    SET @cmd = @cmd + '    ,ERROR_SEVERITY() AS ErrorSeverity ' + CHAR (10) ;
    SET @cmd = @cmd + '    ,ERROR_STATE() AS ErrorState ' + CHAR (10) ;
    SET @cmd = @cmd + '    ,ERROR_PROCEDURE() AS ErrorProcedure ' + CHAR (10) ;
    SET @cmd = @cmd + '    ,ERROR_LINE() AS ErrorLine ' + CHAR (10) ;
    SET @cmd = @cmd + '    ,ERROR_MESSAGE() AS ErrorMessage; ' + CHAR (10) ;
    EXEC (@cmd) ;
  END;

 SET @cmd = '';
 --Build the execution commands
 DECLARE cmdCursor CURSOR
  FOR
    SELECT
        'EXEC proc_GenTrackerCTProc ''' + table_name + ''';'
    FROM information_schema.tables
    WHERE
    table_name LIKE 'BASE_HFIT_Tracker%' AND
    table_name NOT LIKE '%_DEL' AND
    table_name NOT LIKE '%_CTVerHIST' AND
    table_name NOT LIKE '%_TrackerDef%' AND
    table_name NOT LIKE 'BASE_HFIT_Tracker' AND
    table_name NOT LIKE 'BASE_HFit_TrackerDef_Tracker';

 OPEN cmdCursor;
 FETCH NEXT FROM cmdCursor
 INTO @cmd;

 --Build each table usig the previously constructed execution commands.
 WHILE
   @@FETCH_STATUS = 0
  BEGIN
    SET @cmd = REPLACE (@cmd , 'EXEC ' , '') ;
    BEGIN TRY
         if @PreviewOnly = 'NO'
          EXEC (@cmd) ;
      PRINT 'SUCCESS: ' + @cmd;
      PRINT ' ';
    END TRY
    BEGIN CATCH
      PRINT 'ERROR: ' + @cmd;
      EXECUTE usp_GetErrorInfo;
      PRINT ' ';
    END CATCH;
    FETCH NEXT FROM cmdCursor INTO @cmd;
  END;
 CLOSE cmdCursor;
 DEALLOCATE cmdCursor;

 EXEC dbo.proc_TrackerAddTrackerName ;

 EXEC dbo.proc_TrackerAlterPKEY ;

 exec proc_RI_Tracker_User ;

 exec proc_SetTrackerKeyColToStandardLength ;

END;
GO
PRINT 'EXECUTED proc_GenTrackerCTProcMASTER.sql';
GO

</textarea>
</td></tr>

<tr class="bar">
 <td align="left"><a href="javascript:hidecode(sourcecode);" id="hidelink">Hide code</a></td>
 <td align="right"><a href="http://www.aivosto.com/visustin.html">Visustin flow chart for T-SQL</a></td></tr>
</table>

</body>
</html>
