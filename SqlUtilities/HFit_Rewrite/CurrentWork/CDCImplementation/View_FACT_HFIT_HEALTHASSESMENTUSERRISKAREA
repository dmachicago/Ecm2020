

GO
USE KenticoCMS_DataMart;
GO
PRINT 'Executing VIEW_FACT_HFIT_HEALTHASSESMENTUSERRISKAREA.SQL';
GO

IF EXISTS (SELECT
                  table_name
                  FROM information_schema.tables where table_name = 'VIEW_FACT_HFIT_HEALTHASSESMENTUSERRISKAREA'
                  ) 
    BEGIN
    print 'Dropping view VIEW_FACT_HFIT_HEALTHASSESMENTUSERRISKAREA '; 
        DROP VIEW
             VIEW_FACT_HFIT_HEALTHASSESMENTUSERRISKAREA
    END;

GO

CREATE VIEW VIEW_FACT_HFIT_HEALTHASSESMENTUSERRISKAREA
AS SELECT
          HAUSERRISKAREA.ITEMID AS USERRISKAREAITEMID
        , HAUSERRISKAREA.HARISKCATEGORYITEMID
        , HAUSERRISKAREA.CODENAME AS USERRISKAREACODENAME
        , HAUSERRISKAREA.HARISKAREANODEGUID
        , NULL AS HARISKAREAVERSIONID
        , HAUSERRISKAREA.HARISKAREASCORE
        , HAUSERRISKAREA.PREWEIGHTEDSCORE AS RISKAREAPREWEIGHTEDSCORE
        , HAUSERRISKAREA.ITEMMODIFIEDWHEN AS HAUSERRISKAREA_ITEMMODIFIEDWHEN
        , HAUSERRISKAREA.ItemModifiedWhen AS HAUSERRISKAREA_LASTMODIFIED   --HAUSERRISKAREA.LASTLOADEDDATE 
        , 0 AS HAUSERRISKAREA_LastUpdateID   --HAUSERRISKAREA.LastUpdateID 

        , HAUSERQUESTIONGROUPRESULTS.HARISKAREAITEMID
        , HAUSERQUESTIONGROUPRESULTS.ItemID AS HAUSERQUESTIONGROUPRESULTSItemID
        , HAUSERQUESTIONGROUPRESULTS.POINTRESULTS
        , HAUSERQUESTIONGROUPRESULTS.CODENAME AS QUESTIONGROUPCODENAME
        , HAUSERQUESTIONGROUPRESULTS.ItemModifiedWhen AS HAUSERQUESTIONGROUPRESULTS_LASTMODIFIED	--HAUSERQUESTIONGROUPRESULTS.LASTLOADEDDATE 
        , 0 AS HAUSERQUESTIONGROUPRESULTS_LastUpdateID	--HAUSERQUESTIONGROUPRESULTS.LastUpdateID 

        , HAUSERRISKAREA.ItemModifiedWhen AS LastModifiedWhen
        , 0 AS LastUpdateID
        , GETDATE () AS LASTLOADEDDATE
        , HAUSERRISKAREA.SVR
        , HAUSERRISKAREA.DBNAME
        , 0 AS DeletedFlg
        , HAUSERRISKAREA.LastModifiedDate

   --into DIM_EDW_HFit_HealthAssesmentUserRiskArea_Joined
          FROM DBO.FACT_HFIT_HEALTHASSESMENTUSERRISKAREA AS HAUSERRISKAREA
                   LEFT JOIN DBO.FACT_HFIT_HEALTHASSESMENTUSERQUESTIONGROUPRESULTS AS HAUSERQUESTIONGROUPRESULTS
                       ON HAUSERRISKAREA.ITEMID = HAUSERQUESTIONGROUPRESULTS.HARISKAREAITEMID
                      AND HAUSERRISKAREA.SVR = HAUSERQUESTIONGROUPRESULTS.SVR
                      AND HAUSERRISKAREA.DBNAME = HAUSERQUESTIONGROUPRESULTS.DBNAME;

GO
PRINT 'ExecutED VIEW_FACT_HFIT_HEALTHASSESMENTUSERRISKAREA.SQL';
GO

